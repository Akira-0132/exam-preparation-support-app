承知いたしました。
これまでの壁打ち内容を元に、開発の指針となる要件定義書をマークダウン記法で作成します。

---

# ウェブアプリケーション「定期試験対策やりきり支援アプリ」要件定義書 (Supabase版)

## 1. 概要

本ドキュメントは、中学生向けの定期試験対策支援を目的としたウェブアプリケーションの要件を定義するものである。本アプリは、生徒の課題進捗を可視化し、計画的な学習をサポートすることで、学力向上および自己管理能力の育成を目指す。

## 2. プロジェクトの目的とゴール

* **目的**:
    * 生徒が「いつ、何を、どれくらい学習すればよいか」を直感的に把握できるようにする。
    * 講師が生徒一人ひとりの学習状況を正確に把握し、適切な指導を行えるようにする。
    * 試験後の振り返りを容易にし、次の学習計画に活かせるようにする。
* **ゴール**:
    * 生徒の計画的な学習習慣を定着させる。
    * 講師の指導業務を効率化し、指導の質を向上させる。
    * 生徒が卒業まで継続的に利用できる学習ログプラットフォームを構築する。

## 3. ターゲットユーザー

| ユーザー種別 | 主な利用目的 | 主な利用デバイス |
| :--- | :--- | :--- |
| **塾の生徒（中学生）** | 課題進捗の入力・確認、学習計画の把握 | スマートフォン |
| **塾のアルバイト講師** | 担当生徒の進捗確認、学習サポート | スマートフォン |
| **塾講師（管理者）** | 全生徒の進捗管理、アプリの全体運用 | PC |

## 4. 技術スタック

| カテゴリ | 技術 | 備考 |
| :--- | :--- | :--- |
| **フロントエンド** | Next.js (React) | 高速な描画と優れた開発者体験のため |
| **バックエンド** | Supabase (BaaS) | PostgreSQLベースでSQLの利点を活かし、迅速な開発を実現するため |
| **データベース** | PostgreSQL (Supabase) | リレーショナルデータベースの堅牢性と柔軟性のため |
| **認証** | Supabase Auth | 安全で実装が容易な認証機能のため |
| **ホスティング** | Vercel | Next.jsアプリのデプロイを最適化するため |

## 5. 機能要件

### 5.1. ユーザー認証機能
-   Supabase Authを利用したログイン・ログアウト機能を提供する。
-   ユーザーは「生徒」または「講師」の役割(ロール)を持つ。

### 5.2. テスト期間管理機能
-   **新規設定**: ウィザード形式で新しいテスト期間の目標を設定する。
    -   Step 1: 学期制（2期/3期制）とテスト種別（1学期期末など）を選択。
    -   Step 2: 試験が実施される科目を選択。
    -   Step 3: 科目ごとの学習開始前の「自信度」を5段階で入力。
-   **期間切り替え**: ヘッダーのドロップダウンメニューから、現在対策中のテスト期間を切り替える。
-   **振り返り**: 上記メニューから過去のテスト期間を選択し、当時の進捗状況を閲覧できる「振り返りモード」に移行する。

### 5.3. ホーム画面
-   **タスク表示**: ログイン後の最上部に「今日のタスク」「今週のタスク」を一覧表示し、直近の行動を促す。
-   **進捗サマリー**:
    -   全教科の総合進捗率を円グラフ等で視覚的に表示する。
    -   科目ごとの進捗率を棒グラフ等で一覧表示する。
-   **目標表示**: 現在設定中のテスト種別を表示する。未設定の場合は設定画面へ誘導する。

### 5.4. 科目詳細ページ
-   **進捗ゲージ**: ページ上部に以下の2種類の進捗ゲージを常時表示する。
    -   塾の課題ゲージ（青色系）
    -   その他の課題ゲージ（緑色系）
-   **課題リスト**: 課題を以下の3つのセクションに分類して表示する。
    1.  **塾の課題**: 「Finished」「Completed」の2段階ステップ形式で進捗を管理。
    2.  **学校の課題・その他**: 講師が設定したデフォルト課題を表示。
    3.  **自分で追加した課題**: 生徒が任意で追加した課題を表示。

### 5.5. 課題管理機能
-   **CRUD**: 生徒は自身で課題の追加・編集・削除が可能。
-   **完了チェック**: 各課題に完了チェックボックスを設置。チェック時にゲージがアニメーションで増加し、達成感を演出する。
-   **期限設定**:
    -   デフォルト課題の期限は講師が設定する。
    -   生徒が追加した課題は生徒自身が期限を設定できる。
    -   期限までの残り日数に応じて課題の表示色を変化させる（例: 期限切れは赤色）。
-   **重み付け**: 各課題は完了時に進捗ゲージに与える影響度（重み）を持つ。
    -   **塾の課題**: Finishedで50%, Completedで100%
    -   **学校のワーク**: 1周目(30%), 間違い直し(60%), 全問解き直し(85%) など。

## 6. データベース設計 (PostgreSQL/Supabase)

### `user_profiles` テーブル
| フィールド名 | 型 | 説明 |
| :--- | :--- | :--- |
| `id` | UUID | ユーザーID（Supabase Authと連携） |
| `email` | VARCHAR | メールアドレス |
| `display_name` | VARCHAR | 表示名 |
| `role` | ENUM | 役割 (`student` or `teacher`) |
| `class_id` | UUID | 所属クラスID（生徒の場合） |
| `grade` | INTEGER | 学年（生徒の場合） |
| `student_number` | VARCHAR | 生徒番号（生徒の場合） |
| `managed_class_ids` | UUID[] | 管理クラスID配列（講師の場合） |
| `subject` | VARCHAR | 担当科目（講師の場合） |

### `test_periods` テーブル
| フィールド名 | 型 | 説明 |
| :--- | :--- | :--- |
| `id` | UUID | テスト期間ID |
| `title` | VARCHAR | テスト名 (例: `1学期期末`) |
| `start_date` | TIMESTAMP | 開始日 |
| `end_date` | TIMESTAMP | 終了日 |
| `class_id` | UUID | 対象クラスID |
| `subjects` | VARCHAR[] | 試験対象の科目リスト |
| `created_by` | UUID | 作成者ID |

### `tasks` テーブル
| フィールド名 | 型 | 説明 |
| :--- | :--- | :--- |
| `id` | UUID | タスクID |
| `title` | VARCHAR | 課題名 |
| `description` | TEXT | 課題の詳細説明 |
| `subject` | VARCHAR | 科目名 |
| `priority` | ENUM | 優先度 (`low`, `medium`, `high`) |
| `status` | ENUM | ステータス (`not_started`, `in_progress`, `completed`) |
| `due_date` | TIMESTAMP | 期限日時 |
| `estimated_time` | INTEGER | 予想所要時間（分） |
| `actual_time` | INTEGER | 実際の所要時間（分） |
| `test_period_id` | UUID | 関連するテスト期間ID |
| `assigned_to` | UUID | 担当者ID |
| `created_by` | UUID | 作成者ID |
| `weight` | DECIMAL | 進捗ゲージへの影響度 (0.0 ~ 1.0) |

## 7. 非機能要件

| 項目 | 要件 |
| :--- | :--- |
| **UI/UX** | 中学生が直感的に操作できる、シンプルで分かりやすいデザインを採用する。 |
| **レスポンシブ** | スマートフォン、PCのどちらのブラウザでもレイアウトが崩れず、快適に利用できること。 |
| **パフォーマンス**| 画面遷移やデータの読み込みが高速であり、ユーザーにストレスを与えないこと。 |

## 8. Supabase採用の利点

### 8.1. 技術的利点
- **PostgreSQL**: リレーショナルデータベースの堅牢性とACID特性
- **リアルタイム**: WebSocketベースのリアルタイム更新機能
- **RLS**: Row Level Securityによる細かなアクセス制御
- **SQL**: 標準的なSQLクエリによる柔軟なデータ操作

### 8.2. 開発効率
- **自動生成**: TypeScript型定義の自動生成
- **管理画面**: 内蔵のダッシュボードによるデータ管理
- **認証**: 豊富な認証プロバイダーとカスタマイズ性
- **ストレージ**: ファイルアップロード機能

### 8.3. 運用面
- **スケーラビリティ**: 自動的なスケーリング
- **バックアップ**: 自動バックアップと復旧機能
- **監視**: 詳細なログとメトリクス
- **コスト**: 従量課金によるコスト効率

---
